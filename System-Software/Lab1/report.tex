\documentclass[listings]{labreport}
\departmentsubject{Кафедра вычислительной техники}{Системное программное обеспечение}
\titleparts{Лабораторная работа №1}{Введение в UNIX}
\students{Лабушев Тимофей Михайлович}
\usepackage{multicol}

\begin{document}

\maketitlepage

\section*{Базовые команды}

\texttt{ls} (сокр. \textit{list}): отражает имена и атрибуты файлов.
Без аргументов показывает содержание текущей директории. Принимает как аргумент путь к директории или файлу,
информация о которых будет отображена.

\texttt{pwd} (сокр. \textit{print working directory}): выводит полный путь к текущей рабочей директории.

\texttt{cd} (сокр. \textit{change directory}): изменяет текущую рабочую директорию на путь, переданный в аргументе.
Без аргументов выполняет переход в домашнюю директорию (\texttt{\$HOME}).

\texttt{rm} (сокр. \textit{remove}): удаляет файлы и директории, пути к которым передаются в аргументах.

\texttt{mv} (сокр. \textit{move}): перемещает файлы. Если исходный файл и место назначения
располагаются в одной файловой системе, то выполняется переименование (т.е. изменение метаданных без доступа к самим данным).
В противном случае производится копирование в место назначения и удаление исходного файла. Распознает следующие комбинации аргументов:

\begin{enumerate}
\item {[исходный путь]} [путь к существующей директории, в которую будет перемещен файл]
\item {[исходный путь]} [путь к файлу, в который будет переименован исходный]
\item {[несколько исходных путей]} [путь к существующей директории, в которую будут перемещены все файлы]
\end{enumerate}

\texttt{cp} (сокр. \textit{copy}): копирует файлы. Комбинации аргументов сходны принимаемым командой \texttt{mv}; если исходный путь
является директорией, то необходим дополнительный флаг \texttt{-r} для рекурсивного копирования ее содержимого.

\texttt{mkdir} (сокр. \textit{make directory}): создает директории, пути к которым передаются в аргументах, если последние
не указывают на уже существующие файлы.

\texttt{rmdir} (сокр. \textit{remove directory}): удаляет пустые директории.

\texttt{type}: выводит интерпретацию аргументов как команд. Существует несколько типов команд:

\begin{enumerate}
\item \textit{builtin}: встроена в командную оболочку — код содержится в интерпретаторе, при исполнении не создается отдельный процесс
\item \textit{alias}: заменяется текстовой подстановкой (см. \texttt{alias})
\item \textit{file}: указывает на исполняемая файл (\texttt{type} печатает полный путь)
\item \textit{keyword}: является ключевым словом интерпретатора
\item \textit{function}: задана функцией на языке сценариев интерпретатора
\end{enumerate}

\texttt{file}: выводит тип файла, определяя его серией проверок. В частности, считываются сигнатуры бинарных форматов
(байты определенного значения, расположенные по заданному отступу — "\textit{magic number}"),
производится текстовой поиск конструкций некоторых языков программирования.

\texttt{find}: производит файловый поиск по выражениям, которые проверяют название, тип и другие метаданные.
Для каждого результата выполняются заданные действия: выводится путь, вызывается утилита с путем к файлу в аргументах, файл удаялется и т.д.

\texttt{chmod} (сокр. \textit{change mode}): изменяет права доступа к файлу.

\texttt{ln} (сокр. \textit{link}): создает жесткую или символическую (ключ \texttt{-s}) ссылку на файл.
Комбинации аргументов сходны команде \texttt{mv} (см. выше). При вызове \texttt{ln -s} с относительным исходным
путем следует помнить, что он сохраняется в ссылке как есть, а не расширяется до пути относительно директории,
в которой выполняется \texttt{ln}.

\texttt{wc} (сокр. \textit{word count}): подсчитывает число переходов на новую строку (\texttt{-l}),
слов (\texttt{-w}), символов (\texttt{-m}) и байт (\texttt{-c}) в файлах или стандартном потоке ввода,
если аргументы не содержат путей. Слова — непустые последовательности,
отделенные друг от друга при помощи \textit{space}, \textit{tab} или \textit{newline}. Число символов
может отличаться от числа байт при использовании многобайтовых кодировок.

\texttt{tee} (по произношению буквы \textit{T}, иллюстрирующей принцип работы команды): перенаправляет
стандартный поток ввода в стандартный поток вывода, копируя данные в один или несколько файлов.

\texttt{cat} (сокр. \textit{concatenate}): поочередно читает файлы в стандартный поток вывода.

\texttt{tail}: выводит последние \textit{n} строк каждого файла (или содержания стандартного потока ввода).
Число строк определяется ключом \texttt{-n}, по умолчанию равно 10.

\texttt{head}: аналог \texttt{tail} для вывода первых \textit{n} строк.

\texttt{more}: позволяет просматривать содержание текстового файла, интерактивно перемещаясь по нему вперед
или назад на одну строку или экран, и выполнять поиск по содержимому.

\texttt{pg} (сокр. \textit{page}): устаревший аналог \texttt{more}, созданный, когда \texttt{more} не поддерживал
обратного перемещения по файлу.

\texttt{touch}: изменяет на текущее время изменения и доступа к файлам. Несуществующие файлы создаются пустыми.

\subsection*{Замечания}

На месте пути к файлу принимающим его командам может быть передан \texttt{-}, который будет заменен
содержанием стандартного потока ввода.

\section*{Команды для изучения}

\texttt{su} (сокр. \textit{substitute user}): открывает новый процесс командной оболочки с правами другого пользователя.
По умолчанию используется суперпользователь \texttt{root}, при этом не изменяется текущая рабочей директория и
окружение (за исключением \texttt{\$HOME} и \texttt{\$SHELL}).

При передачи в аргументах \texttt{- username} или \texttt{-l username} командная оболочка запускается с правами
пользователя \texttt{username}, при этом очищаются переменные окружения, корректно выставляются \texttt{\$USER} и \texttt{\$PATH},
рабочей выставляется домашняя директория \texttt{username}.

Ключ \texttt{-s} позволяет переопределить запускаемую командную оболочку
(по умолчанию выбирается оболочка из записи пользователя в \texttt{/etc/passwd}).

При помощи ключа \texttt{-c} вместо открытия интерактивной сессии можно передать запускаемой оболочке команду для исполнения.

\noindent\rule{\textwidth}{1pt}

\texttt{chown} (сокр. \textit{change owner}): изменяет владельца и группу файлов. Первым аргументом передаются новый владелец и группа,
разделенные двоеточием, только владелец с двоеточием на конце (присваивается группа владельца) или только владелец (группа не изменяется).
Последующими аргументами передаются файлы. При передаче пути к директории необходим ключ \texttt{-R}, если требуется применить изменения
к ее содержимому. Стоит учитывать, что непривилегированный пользователь не имеет права изменить владельца, даже являясь им.

\texttt{chgrp} (сокр. \textit{change group}): изменяет группу файлов. В отличие от \texttt{chown} позволяет применять изменения
непривилегированным пользователям (если они принадлежат к новой группе).

\noindent\rule{\textwidth}{1pt}

\texttt{less}: пейджер, аналог \texttt{more} с расширенным функционалом. Позволяет перемещаться вперед и назад не только по файлу, но и
стандартному потоку ввода. Ключи, изменяющие поведение (к примеру, \texttt{-N} для отображения номеров строк), могут быть введены во время
работы программы как команды.

Взаимодействие с \texttt{less} похоже на работу в \texttt{vi}: команды \texttt{j} и \texttt{k} используются для построчной навигации;
\texttt{g} для перехода в начало текста, \texttt{G} для перехода в конец; \texttt{/pattern} для текстового поиска вперед, \texttt{n} и \texttt{N}
для прямого и обратного перемещения по результатам; \texttt{q} для выхода.

\noindent\rule{\textwidth}{1pt}

\texttt{split}: разделяет один файл на несколько частей, сохраняя их с названиями \texttt{[prefix]aa}, \texttt{[prefix]ab} и т.д.
Первый аргумент указывает путь к файлу, второй — \texttt{[prefix]}, по умолчанию равный \texttt{x}.

Режимы работы определяются следующими ключами:

\begin{enumerate}
\item \texttt{-b size}: максимальный размер каждой части фиксирован, указывается в байтах или единице, определяемой суффиксом (\texttt{KB}, \texttt{MB});
\item \texttt{-l count}: максимальное количество строк в каждой части фиксировано;
\item \texttt{-n count}: количество частей фиксировано.
\end{enumerate}

Без аргументов утилита считывает стандартный поток ввода и разбивает его на части по 1000 строк.

\noindent\rule{\textwidth}{1pt}

\texttt{join}: соединяет строки из двух файлов, совпадающие по полю. Поле — часть строки, отделенная символом;
по умолчанию разделителем считаются пробел и табуляция, задается ключом \texttt{-t}. Номера полей определяются
ключами \texttt{-1} и \texttt{-2} для первого и второго файла соответственно. Файлы должны быть отсортированы по
полю, которое используется для соединения.

В качестве примера соединим два CSV файла:

\begin{multicols}{2}
\noindent\textit{characters.csv}
\begin{verbatim}
Name,Gender
Bob,M
Alice,F
Charlie,M
Eve,F
Walter,M
\end{verbatim}

\noindent\textit{roles.csv}
\begin{verbatim}
Role,Name
Sender,Alice
Receiver,Bob
Warden,Walter
Third Participant,Charlie
Eavesdropper,Eve
\end{verbatim}
\end{multicols}

Вывод команды \texttt{join -t , -1 1 -2 2 {\textbackslash}} \\
\texttt{<(tail -n +2 characters.csv | sort) {\textbackslash}} \\
\texttt{<(tail -n +2 roles.csv | sort -t , -k 2)}:

\begin{verbatim}
Alice,F,Sender
Bob,M,Receiver
Charlie,M,Third Participant
Eve,F,Eavesdropper
Walter,M,Warden
\end{verbatim}

\noindent\rule{\textwidth}{1pt}

\texttt{paste}: последовательно соединяет строки указанных файлов разделителем.
Ключ \texttt{-d} позволяет задать один или несколько сиволов-разделителей, используемых
поочередно. По умолчанию используется символ табуляции.

\noindent\rule{\textwidth}{1pt}

\texttt{cut}: извлекает заданные сегменты каждой строки каждого входного файла или
стандартного потока ввода. Сегменты определяются промежутками байт (\texttt{-b range}),
символов (\texttt{-c range}) или полей (\texttt{-f range}).

Промежуток может быть определен как содержащий один элемент (\texttt{N}), элементы
начиная с N до конца строки (\texttt{N-}), элементы с N по M включительно (\texttt{N-M}),
элементы с начала строки до M (\texttt{-M}).

Разделитель полей по умолчанию (символ табуляции) может быть изменен на другой
ключом \texttt{-d}.

\noindent\rule{\textwidth}{1pt}

\texttt{tr} (сокр. \textit{translate}): переводит символы из одного набора
в соответствующие символы другого набора. Работает со стандартным потоком ввода.

Пример замены: \texttt{tr 'abc' '012'} преобразует каждое вхождение
\textit{a} в \textit{0}, \textit{b} в \textit{1}, \textit{c} в \textit{2}.

Ключ \texttt{-d} удаляет все вхождения символов из набора.

Ключ \texttt{-s} заменяет для каждого символа из набора его
подряд идущие вхождения на один соответствующий символ. После выполнения
\texttt{tr -s '{\textbackslash}n '}, например, будут исключены пустые строки и пробелы, следующие за пробелом.

\noindent\rule{\textwidth}{1pt}

\texttt{cmp} (сокр. \textit{compare}): сравнивает содержание двух файлов. Если файлы одинаковы,
программа завершается без текстового вывода с кодом 0. В противном случае печатается байт и строка,
с которых содержание различается. Необязательными аргументами являются отступы от начала первого и второго файлов,
содержание до которых не учитывается при сравнении.

\texttt{diff} (сокр. \textit{difference}): построчно сравнивает содержание файлов, выводя все отличия в специальном формате.

В качестве примера сравним следующие файлы:

\begin{multicols}{2}
\noindent\textit{target1}
\begin{verbatim}
original file
we may need to modify this latr
who knows

removed paragraph

\end{verbatim}

\noindent\textit{target2}
\begin{verbatim}
prepended
paragraph

original file
we may need to modify this later
who knows
\end{verbatim}
\end{multicols}

Вывод \texttt{diff target1 target2}:

\begin{verbatim}
0a1,3
> prepended
> paragraph
> 
2c5
< we may need to modify this latr
---
> we may need to modify this later
4,5d6
< 
< removed paragraph
\end{verbatim}

\texttt{a} обозначает добавленные строки, \texttt{d} — удаленные, \texttt{c} —
измененные. Перед действием помечена строка в первом (исходном файле),
после действия — во втором. \texttt{<} указывает на строку из первого файла,
\texttt{>} — из второго.

\noindent\rule{\textwidth}{1pt}

\texttt{patch}: применяет файл, полученный в результате работы команды \texttt{diff},
к одному или нескольким исходным файлам для получения измененных вариантов.

\noindent\rule{\textwidth}{1pt}

\texttt{sort}: построчно сортирует указанные текстовые файлы или стандартный поток ввода.
По умолчанию для сортировки используется вся строка. Ключ \texttt{-k} позволяет
выбрать из нее отдельное поле, разделенное пробелом или табуляцией. Для смены разделителя
используется ключ \texttt{-t}. Для сортировки по числовому значению необходим ключ \texttt{-n}.
Сортировка производится в порядке возрастания; изменение на противополжный производится ключом \texttt{-r}.

\texttt{uniq}: сокращает подряд идущие повторяющиеся строки до одной.

\noindent\rule{\textwidth}{1pt}

\texttt{echo}:

\end{document}
